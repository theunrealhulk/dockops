FROM node:20
WORKDIR /app/qwikjs-app
RUN npm cache clean --force
RUN npm config set registry https://registry.npmjs.org --global
RUN npm config set fetch-timeout 600000
RUN npm config set fetch-retries 5
RUN npm config set loglevel verbose
RUN npm config list
RUN npm ping || { echo 'Cannot reach npm registry, trying fallback...'; npm config set registry https://registry.npmmirror.com; npm ping || { echo 'Cannot reach fallback registry'; exit 1; }; }
RUN npm install -g create-qwik@1.16.0 --verbose
EXPOSE 5173
CMD ["/bin/sh", "-c", "echo 'Checking npm connectivity...'; npm ping || { echo 'Runtime npm registry unreachable, trying fallback...'; npm config set registry https://registry.npmmirror.com; npm ping || { echo 'Runtime fallback registry unreachable'; exit 1; }; }; if [ ! -f 'package.json' ]; then echo 'Creating Qwik app...'; for i in 1 2 3; do npm create qwik@latest empty --outDir . --yes|| { echo 'Attempt $i failed'; sleep 2; }; done || { echo 'Qwik creation failed'; ls -l /app/qwikjs-app; exit 1; }; fi; if [ ! -d 'node_modules' ]; then echo 'Installing dependencies...'; npm install --verbose || { echo 'npm install failed'; ls -l /app/qwikjs-app; exit 1; }; fi; echo 'Starting Qwik server...'; npm run dev"]
