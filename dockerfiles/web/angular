# Use Node.js as the base image
FROM node:latest

# Set working directory
WORKDIR /app

# Install Angular CLI globally
RUN npm install -g @angular/cli

# Set working directory to the Angular project
WORKDIR /app/angular-app

# Expose port 4200 for Angular dev server
EXPOSE 4200

# Conditionally create Angular app if /app/angular-app doesn't exist or is empty
CMD ["/bin/sh", "-c", "if [ ! -d '/app/angular-app' ] || [ -z \"$(ls -A /app/angular-app)\" ]; then ng new angular-app --skip-git --defaults; fi && [ -d 'node_modules' ] || npm i && ng serve --host 0.0.0.0 --poll 2000"]
